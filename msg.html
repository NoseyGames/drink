<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ShadowNet - Serverless P2P</title>
<style>
:root {
    --background: #0a0a0f;
    --surface: #11111f;
    --surface-alt: #1a1a2e;
    --primary: #00ff9d;
    --primary-dark: #00cc7a;
    --text: #f0f0f0;
    --text-muted: #8888aa;
    --border: #222244;
    --danger: #ff4757;
    --success: #2ed573;
}

/* Basic resets */
* { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI', sans-serif; }
body { background: var(--background); color: var(--text); height:100vh; overflow:hidden; }

/* Layout */
.app-container { display:flex; height:100vh; max-width:1400px; margin:0 auto; border-left:1px solid var(--border); border-right:1px solid var(--border); }
.sidebar { width:300px; background:var(--surface); border-right:1px solid var(--border); display:flex; flex-direction:column; overflow:hidden; }
.chat-area { flex:1; display:flex; flex-direction:column; background:var(--background); }

/* Sidebar header */
.sidebar-header { padding:1.5rem; border-bottom:1px solid var(--border); }
.logo { display:flex; align-items:center; gap:0.75rem; font-size:1.5rem; font-weight:800; color:var(--primary); }
.user-profile { margin-top:1.5rem; padding:1rem; background:var(--surface-alt); border-radius:12px; display:flex; align-items:center; gap:1rem; }
.avatar { width:48px; height:48px; border-radius:50%; background:linear-gradient(135deg,var(--primary),#0095ff); display:flex; align-items:center; justify-content:center; font-weight:bold; font-size:1.25rem; }
.user-info h3 { font-size:1rem; margin-bottom:0.25rem; }
.user-id { font-size:0.75rem; color:var(--text-muted); font-family:monospace; background:rgba(0,0,0,0.3); padding:0.25rem 0.5rem; border-radius:4px; cursor:pointer; }

/* Contacts */
.contacts { flex:1; overflow-y:auto; padding:1rem; }
.contacts-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem; }
.add-contact-btn { background: var(--primary); color: var(--background); border:none; width:32px; height:32px; border-radius:50%; cursor:pointer; font-size:1.25rem; display:flex; align-items:center; justify-content:center; }
.contact-item { padding:1rem; margin-bottom:0.5rem; background:var(--surface-alt); border-radius:12px; display:flex; align-items:center; gap:1rem; cursor:pointer; transition: all 0.2s; border:2px solid transparent; }
.contact-item:hover { background:#1e1e3a; transform:translateX(4px); }
.contact-item.active { border-color:var(--primary); background: rgba(0,255,157,0.1); }
.contact-avatar { width:40px; height:40px; border-radius:50%; background:linear-gradient(135deg,#ff6b6b,#ffa502); display:flex; align-items:center; justify-content:center; font-weight:bold; }
.contact-info h4 { font-size:0.9rem; margin-bottom:0.25rem; }
.contact-status { font-size:0.75rem; display:flex; align-items:center; gap:0.5rem; }
.status-indicator { width:8px; height:8px; border-radius:50%; background:var(--text-muted); }
.status-indicator.online { background:var(--success); box-shadow:0 0 8px var(--success); }

/* Chat area */
.chat-header { padding:1rem 1.5rem; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; background:var(--surface); }
.chat-partner-info { display:flex; align-items:center; gap:1rem; }
.chat-actions { display:flex; gap:0.5rem; }
.action-btn { background:transparent; border:1px solid var(--border); color:var(--text); width:36px; height:36px; border-radius:8px; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:all 0.2s; }
.action-btn:hover { background:var(--surface-alt); border-color:var(--primary); }
.messages-container { flex:1; padding:1.5rem; overflow-y:auto; display:flex; flex-direction:column; gap:1rem; background:linear-gradient(180deg, var(--background) 0%, #0c0c18 100%); }
.message { max-width:70%; padding:1rem 1.25rem; border-radius:18px; position:relative; animation: fadeIn 0.3s ease; }
@keyframes fadeIn { from {opacity:0; transform:translateY(10px);} to {opacity:1; transform:translateY(0);} }
.message.sent { align-self:flex-end; background:linear-gradient(135deg,var(--primary),#00cc7a); color:var(--background); border-bottom-right-radius:4px; }
.message.received { align-self:flex-start; background:var(--surface-alt); border-bottom-left-radius:4px; }
.message-content { word-wrap:break-word; line-height:1.5; }
.message-time { font-size:0.75rem; opacity:0.7; margin-top:0.5rem; text-align:right; }
.message.received .message-time { color:var(--text-muted); }

/* Input */
.message-input-container { padding:1rem 1.5rem; border-top:1px solid var(--border); background:var(--surface); }
.input-wrapper { display:flex; gap:0.75rem; align-items:flex-end; }
.message-input { flex:1; background:var(--surface-alt); border:2px solid var(--border); border-radius:12px; padding:1rem 1.25rem; color:var(--text); font-size:1rem; min-height:56px; max-height:200px; resize:none; outline:none; transition:border-color 0.2s; }
.message-input:focus { border-color:var(--primary); }
.send-btn { background:var(--primary); color:var(--background); border:none; width:56px; height:56px; border-radius:12px; cursor:pointer; font-size:1.25rem; display:flex; align-items:center; justify-content:center; transition:all 0.2s; }
.send-btn:hover { background:var(--primary-dark); transform:translateY(-2px); }
.send-btn:disabled { opacity:0.5; cursor:not-allowed; transform:none; }

/* Connection Panel */
.connection-panel { position:fixed; top:1rem; right:1rem; background:var(--surface); border:1px solid var(--border); border-radius:12px; padding:1rem; width:300px; z-index:1000; display:none; }
.connection-panel.active { display:block; animation:slideIn 0.3s ease; }
@keyframes slideIn { from {opacity:0; transform:translateY(-20px);} to {opacity:1; transform:translateY(0);} }
.panel-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem; }
.close-panel { background:transparent; border:none; color:var(--text-muted); cursor:pointer; font-size:1.25rem; }
.peer-id-input, .offer-input, .answer-input { width:100%; padding:0.75rem; background:var(--surface-alt); border:1px solid var(--border); border-radius:8px; color:var(--text); margin-bottom:0.5rem; font-family:monospace; }
.connect-btn { width:100%; padding:0.75rem; background:var(--primary); color:var(--background); border:none; border-radius:8px; cursor:pointer; font-weight:600; margin-bottom:0.5rem; }

/* Mobile */
@media (max-width:768px){ .app-container{flex-direction:column;} .sidebar{width:100%; height:30vh; border-right:none; border-bottom:1px solid var(--border);} .contact-item{padding:0.75rem;} .message{max-width:85%;} }
</style>
</head>
<body>
<div class="app-container">
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="logo">ShadowNet</div>
            <div class="user-profile">
                <div class="avatar" id="userAvatar">U</div>
                <div class="user-info">
                    <h3 id="username">User</h3>
                    <div class="user-id" id="userId">Generating ID...</div>
                </div>
            </div>
        </div>
        <div class="contacts">
            <div class="contacts-header">
                <h3>Contacts</h3>
                <button class="add-contact-btn" id="addContactBtn">+</button>
            </div>
            <div id="contactsList">
                <div class="contact-item" data-id="system">
                    <div class="contact-avatar">S</div>
                    <div class="contact-info">
                        <h4>System</h4>
                        <div class="contact-status"><div class="status-indicator online"></div>Always online</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="chat-area">
        <div class="chat-header">
            <div class="chat-partner-info">
                <div class="contact-avatar" id="chatAvatar">S</div>
                <div>
                    <h3 id="chatPartnerName">System</h3>
                    <div class="contact-status">
                        <div class="status-indicator online" id="chatStatus"></div>
                        <span id="chatStatusText">Online</span>
                    </div>
                </div>
            </div>
            <div class="chat-actions">
                <button class="action-btn" id="clearChatBtn" title="Clear Chat">üóëÔ∏è</button>
            </div>
        </div>

        <div class="messages-container" id="messagesContainer">
            <div class="message received">
                <div class="message-content">Welcome to ShadowNet Serverless P2P chat.</div>
                <div class="message-time">Just now</div>
            </div>
        </div>

        <div class="message-input-container">
            <div class="input-wrapper">
                <textarea class="message-input" id="messageInput" placeholder="Type a message..." rows="1"></textarea>
                <button class="send-btn" id="sendBtn" disabled>‚û§</button>
            </div>
        </div>
    </div>
</div>

<!-- Connection Panel for Manual P2P -->
<div class="connection-panel" id="connectionPanel">
    <div class="panel-header">
        <h3>Connect Peer</h3>
        <button class="close-panel" id="closePanelBtn">√ó</button>
    </div>
    <button class="connect-btn" id="createOfferBtn">Create Offer</button>
    <textarea class="offer-input" id="offerOutput" placeholder="Copy this to your peer..." rows="4" readonly></textarea>
    <textarea class="answer-input" id="answerInput" placeholder="Paste peer answer here..." rows="4"></textarea>
    <button class="connect-btn" id="setAnswerBtn">Set Answer</button>
</div>

<script>
class ShadowNetServerless {
    constructor(){
        this.peer = new RTCPeerConnection();
        this.dataChannel = null;
        this.messagesContainer = document.getElementById('messagesContainer');
        this.currentPeerName = "Peer";
        this.userId = 'user_' + Math.random().toString(36).substr(2, 9);
        this.username = `User_${Math.floor(Math.random()*1000)}`;
        this.setupUI();
        this.setupEventListeners();
        this.peer.ondatachannel = e => this.setupDataChannel(e.channel);
        this.peer.onicecandidate = e => {
            if(e.candidate) console.log("ICE Candidate:", JSON.stringify(e.candidate));
        }
    }

    setupUI(){
        document.getElementById('username').textContent = this.username;
        document.getElementById('userAvatar').textContent = this.username.charAt(0);
        document.getElementById('userId').textContent = this.userId;
    }

    setupDataChannel(channel){
        this.dataChannel = channel;
        this.dataChannel.onopen = ()=>{this.addMessage("System","Connected!"); document.getElementById('sendBtn').disabled=false;}
        this.dataChannel.onclose = ()=>{this.addMessage("System","Disconnected"); document.getElementById('sendBtn').disabled=true;}
        this.dataChannel.onmessage = e=>{
            const msg = JSON.parse(e.data);
            this.addMessage(msg.sender, msg.content, false);
        }
    }

    setupEventListeners(){
        const msgInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        sendBtn.addEventListener('click', ()=>this.sendMessage());
        msgInput.addEventListener('keydown', e=>{
            if(e.key==='Enter'&&!e.shiftKey){ e.preventDefault(); this.sendMessage(); }
        });
        msgInput.addEventListener('input', function(){ this.style.height='auto'; this.style.height=this.scrollHeight+'px'; });

        // Connection panel
        document.getElementById('addContactBtn').addEventListener('click', ()=>document.getElementById('connectionPanel').classList.add('active'));
        document.getElementById('closePanelBtn').addEventListener('click', ()=>document.getElementById('connectionPanel').classList.remove('active'));

        // Create offer
        document.getElementById('createOfferBtn').addEventListener('click', async ()=>{
            this.dataChannel = this.peer.createDataChannel('shadownet');
            this.setupDataChannel(this.dataChannel);
            const offer = await this.peer.createOffer();
            await this.peer.setLocalDescription(offer);
            document.getElementById('offerOutput').value = JSON.stringify(offer);
        });

        // Set answer
        document.getElementById('setAnswerBtn').addEventListener('click', async ()=>{
            const answer = JSON.parse(document.getElementById('answerInput').value);
            await this.peer.setRemoteDescription(answer);
            document.getElementById('connectionPanel').classList.remove('active');
        });
    }

    sendMessage(){
        const input = document.getElementById('messageInput');
        const content = input.value.trim();
        if(!content||!this.dataChannel||this.dataChannel.readyState!=='open') return;
        const message = {sender:this.username, content};
        this.dataChannel.send(JSON.stringify(message));
        this.addMessage(this.username, content, true);
        input.value=''; input.style.height='auto';
    }

    addMessage(sender, content, isSent=true){
        const div = document.createElement('div');
        div.className = `message ${isSent?'sent':'received'}`;
        div.innerHTML = `<div class="message-content">${this.escapeHtml(content)}</div><div class="message-time">${new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})}</div>`;
        this.messagesContainer.appendChild(div);
        this.messagesContainer.scrollTop=this.messagesContainer.scrollHeight;
    }

    escapeHtml(text){ const div=document.createElement('div'); div.textContent=text; return div.innerHTML; }
}

document.addEventListener('DOMContentLoaded', ()=>window.messenger=new ShadowNetServerless());
</script>
</body>
</html>

